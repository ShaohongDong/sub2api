# =============================================================================
# Sub2API Infrastructure Deployment Environment
# =============================================================================
# This file is used with docker-compose.infra.local.yml.
# The infra-deploy.sh script will auto-generate .env.infra from this template.
# =============================================================================

# -----------------------------------------------------------------------------
# Core Deployment
# -----------------------------------------------------------------------------
# infra-deploy.sh supports:
# - --mode infra (postgres + redis only)
# - --mode full  (postgres + redis + sub2api)
DEPLOY_MODE=full

# -----------------------------------------------------------------------------
# Images
# -----------------------------------------------------------------------------
SUB2API_IMAGE=weishaw/sub2api:latest
POSTGRES_IMAGE=postgres:18-alpine
# Redis 7 is the default baseline. Use redis:8-alpine when needed.
REDIS_IMAGE=redis:7-alpine

# -----------------------------------------------------------------------------
# Server
# -----------------------------------------------------------------------------
BIND_HOST=0.0.0.0
SERVER_PORT=8080
SERVER_MODE=release
RUN_MODE=standard
TZ=Asia/Shanghai

# -----------------------------------------------------------------------------
# PostgreSQL
# -----------------------------------------------------------------------------
DATABASE_PORT=5432
POSTGRES_USER=sub2api
POSTGRES_PASSWORD=change_this_secure_password
POSTGRES_DB=sub2api

# PostgreSQL server tuning (optional)
POSTGRES_MAX_CONNECTIONS=1024
POSTGRES_SHARED_BUFFERS=1GB
POSTGRES_EFFECTIVE_CACHE_SIZE=4GB
POSTGRES_MAINTENANCE_WORK_MEM=128MB

# Sub2API database connection pool
DATABASE_MAX_OPEN_CONNS=256
DATABASE_MAX_IDLE_CONNS=128
DATABASE_CONN_MAX_LIFETIME_MINUTES=30
DATABASE_CONN_MAX_IDLE_TIME_MINUTES=5

# -----------------------------------------------------------------------------
# Redis
# -----------------------------------------------------------------------------
REDIS_PORT=6379
REDIS_PASSWORD=change_this_secure_password
REDIS_DB=0
REDIS_MAXCLIENTS=50000
REDIS_POOL_SIZE=4096
REDIS_MIN_IDLE_CONNS=256

# -----------------------------------------------------------------------------
# Admin
# -----------------------------------------------------------------------------
ADMIN_EMAIL=admin@sub2api.local
# Leave empty to auto-generate on first startup (check container logs).
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Generate with: openssl rand -hex 32
JWT_SECRET=
JWT_EXPIRE_HOUR=24
TOTP_ENCRYPTION_KEY=
